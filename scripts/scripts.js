"use strict";angular.module("yapp",["ui.router","ngAnimate","restangular","ui.mask","720kb.datepicker","naif.base64","pubnub.angular.service"]).config(["$stateProvider","$urlRouterProvider","RestangularProvider",function(t,e,a){var o="https://happserver.casadeapostas.com/api/v1/";a.setBaseUrl(o),e.otherwise("/pubnub"),t.state("base",{"abstract":!0,url:"",templateUrl:"views/base.html"}).state("pubnub",{url:"/pubnub",parent:"base",templateUrl:"views/pubnub.html",controller:"PubNubCtrl"}).state("dashboard",{url:"/dashboard",parent:"base",templateUrl:"views/dashboard.html",controller:"DashboardCtrl"}).state("overview",{url:"/overview",parent:"dashboard",templateUrl:"views/dashboard/overview.html",controller:"OverViewCtrl"})}]),angular.module("yapp").controller("DashboardCtrl",["$scope","$state",function(t,e){t.$state=e}]),angular.module("yapp").controller("OverViewCtrl",["$scope","$rootScope","$state","$http","$timeout","Restangular",function(t,e,a,o,s,i){t.$state=a,i.setDefaultHeaders({"Content-Type":"application/json"}),t.APPID="CAWEBPUB1",t.APPTOKEN="31AE04E3E6",t.EMPTY="",t.listMarkets=[],e.listModalities=[],t.listCategories=[],t.listTournaments=[],e.listEvents=[],t.listOdds=[],e.list=[],e.vm={},t.flagEventReady=!1,t.listCount=10,t.token={APPID:t.APPID,APPTOKEN:t.APPTOKEN,HashFinalizadoras:t.EMPTY,HashModalidadeRoteiros:t.EMPTY},t.tokenCategories={APPID:t.APPID,APPTOKEN:t.APPTOKEN,OffSetCategoria:0},t.tokenTournaments={APPID:t.APPID,APPTOKEN:t.APPTOKEN,OffSetTorneio:0},t.tokenEventsOdds={APPID:t.APPID,APPTOKEN:t.APPTOKEN,OffSetEvento:0,OffSetOdd:0},t.tokenEvents={APPID:t.APPID,APPTOKEN:t.APPTOKEN,OffSetEvento:0,OffSetOdd:-1},t.tokenOdds={APPID:t.APPID,APPTOKEN:t.APPTOKEN,OffSetEvento:-1,OffSetOdd:0},t.findByMI=function(e){return e.MI==t.compare},t.findByCI=function(e){return e.CI==t.compare},t.findByTI=function(e){return e.TI==t.compare},t.findByModalidadeId=function(e){return e.ModalidadeId==t.compare},t.findOdd=function(e){return e.MI==t.compareMI&&e.Od==t.compareOd&&e.EI==t.compareEI&&e.Fa==t.compareFa},e.showMore=function(){t.listCount+=10},e.selectModality=function(a){t.isLoading=!0,t.listCount=10,e.listEvents&&(e.selectedItem=a.ModalidadeId,t.compare=a.ModalidadeId,e.list=JSON.parse(JSON.stringify(e.listEvents.filter(t.findByMI))),0!=e.list.length||t.isLoadingAll?e.list.length>0&&(t.isLoading=!1):t.isLoading=!1)},e.search=function(t){e.vm.searchEvents&&""!=e.vm.searchEvents?e.flagSearch=!0:e.flagSearch=!1},t.getCategories=function(){i.all("root/Categoria/WorkForce").post(t.tokenCategories).then(function(e){if(e&&e.Categorias)for(var a=0;a<e.Categorias.length;a++)t.listCategories.push(e.Categorias[a]);e&&e.ProximoOffSetCategoria!=-1?(t.tokenCategories.ProximoOffSetCategoria=e.ProximoOffSetCategoria,t.getCategories()):(console.log("Lista Categorias = "+t.listCategories.length),t.categoriesReady=!0)},function(e){console.log(e),t.getAuth()})["finally"](function(){console.log("$scope.getCategories consumido.")})},t.getTournaments=function(){i.all("root/Categoria/WorkForce").post(t.tokenTournaments).then(function(e){if(e&&e.Torneios)for(var a=0;a<e.Torneios.length;a++)t.listTournaments.push(e.Torneios[a]);e&&e.ProximoOffSetTorneio!=-1?(t.tokenTournaments.OffSetTorneio=e.ProximoOffSetTorneio,t.getTournaments()):(console.log("Lista Torneios = "+t.listTournaments.length),t.tournamentsReady=!0)},function(e){console.log(e),t.getAuth()})["finally"](function(){console.log("$scope.getTournaments consumido.")})},t.getEventsOdds=function(){i.all("root/Evento/WorkForce").post(t.tokenEventsOdds).then(function(e){var a=!1,o=!1;if(e&&e.Odds)for(var s=0;s<e.Odds.length;s++)t.listOdds.push(e.Odds[s]);t.categoriesReady&&t.tournamentsReady&&t.overviewTemporary(e.Eventos),e&&e.ProximoOffSetEvento!=-1?(t.tokenEventsOdds.OffSetEvento=e.ProximoOffSetEvento,a=!0):(t.tokenEventsOdds.OffSetEvento=-1,a=!1),e&&e.ProximoOffSetOdd!=-1?(t.tokenEventsOdds.OffSetOdd=e.ProximoOffSetOdd,o=!0):(t.tokenEventsOdds.OffSetOdd=-1,o=!1),(a||o)&&t.getEventsOdds(),a||o||(t.isLoading=!1,t.isLoadingAll=!1,t.overview())},function(e){console.log(e),t.getAuth()})["finally"](function(){console.log("$scope.getEvents consumido.")})},t.getAuth=function(){i.all("auth/AuthWebPub1").post(t.token).then(function(e){if(e){var a={};a.listModalities=e.Modalidades,a.listMarkets=e.Mercados,a.token=e.SessaoToken,a.maximaCotacaoAV=e.MaximaCotacaoAV,a.maximaCotacaoPM=e.MaximaCotacaoPM,a.minimaCotacaoAV=e.MinimaCotacaoAV,a.minimaCotacaoPM=e.MinimaCotacaoPM,a.listModalitieScripts=e.ModalidadeRoteiros,localStorage.setItem("AuthWebPub1",JSON.stringify(a)),t.load()}},function(t){console.log(t)})["finally"](function(){console.log("$scope.getAuth consumido.")})},t.load=function(){var a=JSON.parse(localStorage.getItem("AuthWebPub1"));e.listModalities=a.listModalities,t.listMarkets=a.listMarkets,i.setDefaultHeaders({"Content-Type":"application/json",sessaoToken:a.token}),t.getCategories(),t.getTournaments(),t.getEventsOdds()},t.overviewTemporary=function(a){for(var o=0;o<a.length;o++){a[o].show=!0;var s=a[o].Ini,i=s?new Date(s).toLocaleDateString():(new Date).toLocaleDateString(),n=s?new Date(s).toLocaleTimeString():(new Date).toLocaleDateString();new Date(s)>new Date?a[o].IniFormatada=i+" às "+n:a[o].IniFormatada=null,a[o].listMainOdds=[],t.compare=a[o].MI,a[o].MN=e.listModalities.find(t.findByModalidadeId).Nome,a[o].listMainOdds=JSON.parse(JSON.stringify(e.listModalities.find(t.findByModalidadeId).OddsPrincipais)),t.compare=a[o].CI,a[o].CN=t.listCategories.find(t.findByCI).No,t.compare=a[o].TI,a[o].TN=t.listTournaments.find(t.findByTI).No;for(var d=0;d<a[o].listMainOdds.length;d++){var l=a[o].listMainOdds[d].MercadoId,r=a[o].listMainOdds[d].Odd,c=a[o].EI,f=a[o].listMainOdds[d].Faixa;t.compareMI=l,t.compareOd=r,t.compareEI=c,t.compareFa=f;var u=t.listOdds.find(t.findOdd);u&&(a[o].listMainOdds[d].Cotacao=u.Co,1==u.St?a[o].show=!0:a[o].show=!1,a[o].show&&0==a[o].St?a[o].show=!0:a[o].show=!1)}}for(var o=0;o<a.length;o++){for(var v=JSON.parse(localStorage.getItem("AuthWebPub1")),m=a[o].MI<1e4?v.maximaCotacaoPM:v.maximaCotacaoAV,O=a[o].MI<1e4?v.minimaCotacaoPM:v.minimaCotacaoAV,d=0;d<a[o].listMainOdds.length;d++){a[o].listMainOdds[d].Cotacao>m&&(a[o].listMainOdds[d].Cotacao=m),a[o].listMainOdds[d].Cotacao<O&&(a[o].listMainOdds[d].Cotacao=O),t.compare=a[o].MI;var M=v.listModalitieScripts.find(t.findByModalidadeId);a[o].listMainOdds[d].MercadoId<1e4?a[o].listMainOdds[d].Cotacao&&(a[o].listMainOdds[d].Cotacao=a[o].listMainOdds[d].Cotacao*(100+M.TaxaAjusteCotacao)/100):a[o].listMainOdds[d].Cotacao&&(a[o].listMainOdds[d].Cotacao=a[o].listMainOdds[d].Cotacao*(100+M.TaxaAjusteCotacaoAV)/100)}e.listEvents.push(a[o])}e.selectedItem?e.selectModality({ModalidadeId:e.selectedItem}):e.selectModality({ModalidadeId:1})},t.overview=function(){console.log("FINALIZOU"),e.finalized=!0;for(var a=0;a<e.listEvents.length;a++){e.listEvents[a].show=!1;var o=e.listEvents[a].Ini,s=o?new Date(o).toLocaleDateString():(new Date).toLocaleDateString(),i=o?new Date(o).toLocaleTimeString():(new Date).toLocaleDateString();new Date(o)>new Date?e.listEvents[a].IniFormatada=s+" às "+i:e.listEvents[a].IniFormatada=null,e.listEvents[a].listMainOdds=[],t.compare=e.listEvents[a].MI,e.listEvents[a].MN=e.listModalities.find(t.findByModalidadeId).Nome,e.listEvents[a].listMainOdds=JSON.parse(JSON.stringify(e.listModalities.find(t.findByModalidadeId).OddsPrincipais)),t.compare=e.listEvents[a].CI,e.listEvents[a].CN=t.listCategories.find(t.findByCI).No,t.compare=e.listEvents[a].TI,e.listEvents[a].TN=t.listTournaments.find(t.findByTI).No;for(var n=0;n<e.listEvents[a].listMainOdds.length;n++){var d=e.listEvents[a].listMainOdds[n].MercadoId,l=e.listEvents[a].listMainOdds[n].Odd,r=e.listEvents[a].EI,c=e.listEvents[a].listMainOdds[n].Faixa;t.compareMI=d,t.compareOd=l,t.compareEI=r,t.compareFa=c;var f=t.listOdds.find(t.findOdd);f&&(e.listEvents[a].listMainOdds[n].Cotacao=f.Co,1==f.St?e.listEvents[a].show=!0:e.listEvents[a].show=!1,e.listEvents[a].show&&0==e.listEvents[a].St?e.listEvents[a].show=!0:e.listEvents[a].show=!1)}}for(var a=0;a<e.listEvents.length;a++){for(var u=JSON.parse(localStorage.getItem("AuthWebPub1")),v=e.listEvents[a].MI<1e4?u.maximaCotacaoPM:u.maximaCotacaoAV,m=e.listEvents[a].MI<1e4?u.minimaCotacaoPM:u.minimaCotacaoAV,n=0;n<e.listEvents[a].listMainOdds.length;n++){e.listEvents[a].listMainOdds[n].Cotacao>v&&(e.listEvents[a].listMainOdds[n].Cotacao=v),e.listEvents[a].listMainOdds[n].Cotacao<m&&(e.listEvents[a].listMainOdds[n].Cotacao=m),t.compare=e.listEvents[a].MI;var O=u.listModalitieScripts.find(t.findByModalidadeId);e.listEvents[a].listMainOdds[n].MercadoId<1e4?e.listEvents[a].listMainOdds[n].Cotacao&&(e.listEvents[a].listMainOdds[n].Cotacao=e.listEvents[a].listMainOdds[n].Cotacao*(100+O.TaxaAjusteCotacao)/100):e.listEvents[a].listMainOdds[n].Cotacao&&(e.listEvents[a].listMainOdds[n].Cotacao=e.listEvents[a].listMainOdds[n].Cotacao*(100+O.TaxaAjusteCotacaoAV)/100)}e.listEvents[a].show||e.listEvents.splice(a,1)}e.selectedItem&&e.selectModality({ModalidadeId:e.selectedItem});for(var a=0;a<e.listModalities.length;a++){t.compare=e.listModalities[a].ModalidadeId;var f=e.listEvents.filter(t.findByMI);f&&0!=f.length?e.listModalities[a].notShow=!1:e.listModalities[a].notShow=!0}setTimeout(function(){t.overview()},6e4)},t.isLoading=!0,t.isLoadingAll=!0,localStorage.getItem("AuthWebPub1")?t.load():t.getAuth(),t.pubnub=function(){var t="sub-c-9a97197e-465c-11e7-bc55-0619f8945a4f",e=new PubNub({subscribeKey:t,ssl:!0,cipherKey:"6532353062663461393066313131643239386633373439326536656432363666"});e.addListener({message:function(t){console.log("CANAL:"+t.channel+" "+t.message)},presence:function(t){},status:function(t){}}),e.subscribe({channels:["ATUEVT2"]})},t.pubnub()}]);